<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configuração de E-mail · OrderSync</title>

  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- CSS Global e Navbar -->
  <link rel="stylesheet" href="../navbar.css">
  <style>
    /* config_email.css - Component specific styles */
    /* Global layout handled by navbar.css and bootstrap */

    body {
      background-color: #f3f4f6;
      font-family: 'Inter', sans-serif;
    }

    .page-container {
      max-width: 900px;
      margin: 40px auto;
      padding: 0 20px;
    }

    .card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      padding: 32px;
      border: 1px solid #e5e7eb;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 8px;
      border-bottom: 1px solid #e5e7eb;
      margin-bottom: 16px;
      margin-top: 20px;
    }

    .tab {
      appearance: none;
      border: 1px solid #e5e7eb;
      border-bottom: none;
      background: #f9fafb;
      padding: 10px 14px;
      border-radius: 8px 8px 0 0;
      cursor: pointer;
      color: #111827;
      font-weight: 500;
    }

    .tab.active {
      background: #fff;
      font-weight: 600;
      border-bottom-color: #fff;
      margin-bottom: -1px;
    }

    .tab-panel {
      display: none;
      padding: 10px 0;
    }

    .tab-panel.active {
      display: block;
    }

    /* Form Fields */
    .form {
      display: block;
    }

    .field {
      margin-bottom: 14px;
    }

    .field>label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      color: #374151;
      font-size: 0.9em;
    }

    .field>small,
    .help {
      color: #6b7280;
      font-size: 12px;
    }

    .field.checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .field.checkbox>label {
      margin: 0;
      font-weight: 500;
    }

    textarea {
      resize: vertical;
    }

    /* Grid for SMTP fields */
    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }

    @media (max-width: 720px) {
      .grid-2 {
        grid-template-columns: 1fr;
      }
    }

    /* Actions */
    .actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      padding-top: 10px;
      border-top: 1px solid #eee;
    }

    .btn {
      padding: 10px 14px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      background: #fff;
      cursor: pointer;
      font-weight: 500;
    }

    .btn.primary {
      background: #2563eb;
      color: #fff;
      border-color: #2563eb;
    }

    .btn:hover {
      opacity: 0.9;
    }

    .btn:disabled {
      opacity: .6;
      cursor: not-allowed;
    }

    /* Make inputs fit Bootstrap-like if not included */
    input[type="text"],
    input[type="email"],
    input[type="number"],
    input[type="password"],
    textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      background: #fff;
      outline: none;
      font-family: inherit;
      font-size: 14px;
    }

    input:focus,
    textarea:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
    }
  </style>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <script src="../js/auth.js"></script>
  <script src="../js/sidebar_control.js"></script>
  <script>
    if (window.Auth) {
      window.Auth.checkAuth();
    }
  </script>

  <script>
    window.API_BASE = "http://localhost:8000"; // Or dynamic based on env, simplifying for dev
    // Better to keep the existing logic if it was working for others, but let's stick to the one usually used.
    // The previous file had "https://ordersync-backend-59d2.onrender.com" and then typically local overrides.
    // I'll stick to a safe default or what was used in other working files.
    // Actually, let's use the one from the bottom of the original file which seemed more recent/active context?
    // "https://ordersync-backend-59d2.onrender.com" was in both.

    window.API_BASE = "https://ordersync-backend-59d2.onrender.com";
    window.CONFIG_EMAIL_BASE = window.API_BASE + "/admin/config_email";
    window.NETDIAG_BASE = window.API_BASE + "/admin/netdiag";

    window.CONFIG_EMAIL_ENDPOINTS = {
      mensagem: window.CONFIG_EMAIL_BASE + "/mensagem",
      smtp: window.CONFIG_EMAIL_BASE + "/smtp",
      testarEnvio: window.CONFIG_EMAIL_BASE + "/teste_envio"
    };
  </script>
  <script defer src="config_email.js?v=tab-6"></script>
</head>

<body>

  <!-- Header (Faixa Superior) -->
  <header>
    <div class="navbar">
      <button class="menu-btn" id="menu-button">&#9776;</button>
      <img src="../logo.png" alt="Logo" class="logo" />
    </div>
  </header>

  <!-- Sidebar -->
  <nav class="sidebar" id="sidebar">
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/clientes/cliente.html">Cadastrar Cliente</a></li>
      <li><a href="#">Atualizar Catálogo</a></li>
      <li><a href="/pedido/pedido.html">Consultar Pedidos</a></li>
      <li><a href="#">Exportar Relatórios</a></li>
      <li><a href="/tabela_preco/criacao_tabela_preco.html">Tabela Preço</a></li>
      <li><a href="/produto/produto.html">Produtos</a></li>
      <li><a href="/usuarios.html">Usuários</a></li>
      <li><a href="/config_email/config_email.html" class="active">Configuração E-mail</a></li>
      <li><a href="#" onclick="window.Auth.openChangePasswordModal()">Trocar Senha</a></li>
      <li><a href="#" onclick="window.Auth.logout()">Sair</a></li>
    </ul>
  </nav>
  <div id="overlay"></div>

  <!-- Main Content Wrapper -->
  <div class="page-container">
    <div class="card" style="margin-top: 20px;">
      <!-- Header interno do Card -->
      <div class="header" style="padding-bottom:10px; border-bottom:1px solid #eee; margin-bottom:20px;">
        <div class="title" style="font-size:1.2rem; font-weight:600;">CONFIGURAÇÃO DE E-MAIL</div>
      </div>

      <nav class="tabs" role="tablist" aria-label="Configuração de e-mail">
        <button class="tab active" data-tab="tab-mensagem" role="tab" aria-selected="true">Mensagem</button>
        <button class="tab" data-tab="tab-smtp" role="tab" aria-selected="false">SMTP</button>
      </nav>

      <!-- Guia: Mensagem -->
      <section id="tab-mensagem" class="tab-panel active" role="tabpanel" aria-labelledby="Mensagem">
        <form id="form-mensagem" class="form">
          <div class="field">
            <label>Destinatário interno <small>(separar por vírgula)</small></label>
            <textarea id="destinatario_interno" rows="3"
              placeholder="ex.: pedidos@empresa.com, compras@empresa.com"></textarea>
          </div>

          <div class="field">
            <label>Assunto padrão</label>
            <input id="assunto_padrao" type="text" placeholder="Novo pedido {{pedido_id}}" />
          </div>

          <div class="field">
            <label>Corpo do e-mail <small>(HTML permitido)</small></label>
            <textarea id="corpo_html" rows="8"
              placeholder="<p>Olá {{cliente_nome}}, seu pedido {{pedido_id}} foi recebido...</p>"></textarea>
            <p class="help">Placeholders: <code>{{pedido_id}}</code>, <code>{{cliente_nome}}</code>,
              <code>{{total_pedido}}</code>, <code>{{link_pdf}}</code>
            </p>
          </div>

          <div class="field checkbox">
            <input id="enviar_para_cliente" type="checkbox" />
            <label for="enviar_para_cliente">Enviar também para o cliente</label>
          </div>

          <div class="actions">
            <button type="button" id="btnSalvarMensagem" class="btn primary">Salvar</button>
            <button type="button" id="btnTestarEnvio" class="btn">Testar envio</button>
          </div>
        </form>
      </section>

      <!-- Guia: SMTP -->
      <section id="tab-smtp" class="tab-panel" role="tabpanel" aria-labelledby="SMTP">
        <form id="form-smtp" class="form">
          <div class="grid-2">
            <div class="field">
              <label>Remetente (From)</label>
              <input id="remetente_email" type="email"
                placeholder="Pedidos &lt;pedidos@empresa.com&gt; ou pedidos@empresa.com" />
            </div>
            <div class="field">
              <label>Servidor SMTP (host)</label>
              <input id="smtp_host" type="text" placeholder="smtp.seudominio.com" />
            </div>
            <div class="field">
              <label>Porta</label>
              <input id="smtp_port" type="number" min="1" step="1" value="587" />
            </div>
            <div class="field">
              <label>Usuário SMTP</label>
              <input id="smtp_user" type="text" placeholder="pedidos@empresa.com" />
            </div>
            <div class="field">
              <label>Senha SMTP</label>
              <input id="smtp_senha" type="password" />
            </div>
            <div class="field checkbox">
              <input id="usar_tls" type="checkbox" checked />
              <label for="usar_tls">Usar TLS</label>
            </div>
          </div>

          <div class="actions">
            <button type="button" id="btnSalvarSMTP" class="btn primary">Salvar</button>
            <button type="button" id="btnTestarSMTP" class="btn">Testar conexão</button>
          </div>
        </form>
      </section>
    </div>
  </div>

  <script>
    const menuButton = document.getElementById("menu-button");
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");

    if (menuButton && sidebar && overlay) {
      menuButton.addEventListener("click", () => {
        sidebar.classList.toggle("active");
        overlay.style.display = sidebar.classList.contains("active") ? "block" : "none";
      });
      overlay.addEventListener("click", () => {
        sidebar.classList.remove("active");
        overlay.style.display = "none";
      });
    }
  </script>
</body>

</html>