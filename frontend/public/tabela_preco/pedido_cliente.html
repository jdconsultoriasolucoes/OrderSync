<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Confirmação de Pedido</title>
  <link rel="stylesheet" href="/static/tabela_preco/pedido_cliente.css?v=20251013h">
</head>
<body>
  <div class="documento">
    <header>
      <div class="logo-cliente">
        <img src="/static/tabela_preco/logo_cliente_supra.png" alt="Logo do Cliente">
      </div>
      <div class="dados-header">
        <h1>Solicitação de orçamento</h1>
        <div class="meta-link" style="font-size:12px;color:#666;margin-top:4px;">
          Data do pedido: <span id="datadopedido">—</span>
        </div>
        <p><strong>Cliente:</strong> <span id="razaoSocialCliente">---</span></p>
        <p><strong>Validade:</strong> <span id="validadeTabela">---</span> (<span id="tempoRestante">---</span>)</p>
        <p><strong id="labelEntregaRetirada">Data:</strong> <span id="dataEntregaValor">a combinar</span></p> 
      </div>
    </header>

    <main>
      <table id="tabelaProdutos">
        <thead>
          <tr>
            <th>Código</th>
            <th>Produto</th>
            <th>Embal.</th>
            <th>Condição de Pagamento</th>
            <th>Peso</th> <!-- Retirado por pedido do Edson, o campo continua sendo calculado, para retornar ele necessario retirar do CSS regra de ocultar -->
            <th>Valor <span id="tituloValorFrete">c/ Frete</span></th>
            <th>Qtd</th>
            <th>Subtotal</th> <!-- Retirado por pedido do Edson, o campo continua sendo calculado, para retornar ele necessario retirar do CSS regra de ocultar -->
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <section class="fechamento-grid">
        <!-- CAIXA ESQUERDA: Totais -->
        <div class="fechamento-card">
          <div class="fech-row">
            <div class="fech-label">Total em Peso Bruto</div>
            <div class="fech-value"><span id="totalPesoPedido">0</span> kg</div>
          </div>
          <div class="fech-row">
            <div class="fech-label">Total em Valor</div>
            <div class="fech-value"><strong>R$ <span id="totalGeral">0,00</span></strong></div>
          </div>
        </div>

        <!-- CAIXA DIREITA: Observações do Cliente -->
        <div class="obs-card">
          <div class="obs-title">Observações do Cliente:</div>
          <div class="obs-body">
            <textarea id="observacaoPedido" maxlength="100" placeholder="Digite aqui..."></textarea>
            <div class="obs-count"><span id="obsCount">0</span>/100</div>
          </div>
        </div>
      </section>
      <div class="acoes">
        <button id="btnConfirmar">Confirmar Pedido</button>
        <button id="btnCancelar">Cancelar</button>
      </div>
     
      <div class="marca-dagua">
        <img src="/static/tabela_preco/logo.png" alt="Marca d'água OrderSync">
       </div>
      <p id="mensagem"></p>
    </main>
  </div>

  <!-- defina sua API (ajuste para prod) -->
<script>
  window.API_BASE = window.API_BASE || "https://ordersync-backend-edjq.onrender.com";
</script>
<script src="/static/tabela_preco/pedido_cliente.js?v=20251012c"></script>
<!-- resolve o /p/{code} e expõe os globais -->
<script>
  window.addEventListener('DOMContentLoaded', () => {
    const API = (p) => `${(window.API_BASE || location.origin).replace(/\/$/,'')}${p}`;
    const code = location.pathname.split('/').pop();

   fetch(API(`/link_pedido/resolver?code=${encodeURIComponent(code)}`), { cache:'no-store' })
      .then(r => { if (!r.ok) throw new Error('resolver '+r.status); return r.json(); })
      .then(d => {
        window.currentTabelaId  = d.tabela_id;
        window.currentComFrete  = d.com_frete;
        window.entregaISO       = (typeof d.data_prevista === 'string' ? d.data_prevista : null); // << NOVO
        console.log('[resolver] ok', d);

        if (typeof window.carregarPedido === 'function') {
          window.carregarPedido();
        } else {
          setTimeout(() => window.carregarPedido && window.carregarPedido(), 0);
        }
      })
      .catch(err => console.error('[resolver] fail', err));
  });
</script>

  <div id="confirmModal" class="modal" hidden>
  <div class="modal-backdrop"></div>
  <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
    <h2 id="confirmTitle">Pedido confirmado ✅</h2>
    <p class="confirm-text">Recebemos seu pedido e ele já está sendo processado.</p>
    <p id="confirmPedidoInfo" class="confirm-info"></p>
    <button id="btnFecharConfirm" type="button" onclick="closeConfirmModal()">Fechar</button>
  </div>
</div>
</body>
</html>