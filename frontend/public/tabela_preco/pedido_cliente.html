<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Confirmação de Pedido</title>
  <link rel="stylesheet" href="/static/tabela_preco/pedido_cliente.css">
</head>
<body>
  <div class="documento">
    <header>
      <div class="logo-cliente">
        <img src="/static/tabela_preco/assets/logo_cliente_supra.png" alt="Logo do Cliente">
      </div>
      <div class="dados-header">
        <h1>Proposta Comercial</h1>
        <p><strong>Cliente:</strong> <span id="cnpjCliente">---</span> - <span id="razaoSocialCliente">---</span></p>
        <p><strong>Condição de Pagamento:</strong> <span id="condicaoPagamento">---</span></p>
        <p><strong>Validade:</strong> <span id="validadeTabela">---</span> (<span id="tempoRestante">---</span>)</p>
      </div>
    </header>

    <main>
      <table id="tabelaProdutos">
        <thead>
          <tr>
            <th>Código</th>
            <th>Produto</th>
            <th>Embalagem</th>
            <th>Peso</th>
            <th>Valor <span id="tituloValorFrete">c/ Frete</span></th>
            <th>Quantidade</th>
            <th>Subtotal</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="total">
        <p><strong>Total:</strong> R$ <span id="totalGeral">0,00</span></p>
      </div>

      <div class="acoes">
        <button id="btnConfirmar">Confirmar Pedido</button>
        <button id="btnCancelar">Cancelar</button>
      </div>
     
      <div class="marca-dagua">
        <img src="/static/tabela_preco/assets/logo.png" alt="Marca d'água OrderSync">
       </div>
      <p id="mensagem"></p>
    </main>
  </div>

  <!-- defina sua API (ajuste para prod) -->
<script>
  window.API_BASE = window.API_BASE || "https://ordersync-backend-edjq.onrender.com";
</script>

<!-- resolve o /p/{code} e expõe os globais -->
<script>
(function () {
  try {
    const parts = location.pathname.split("/").filter(Boolean);
    const code  = parts[parts.length - 1];
    const okPath = parts[parts.length - 2] === "p";
    if (!okPath || !code) return; // se não for /p/{code}, deixa o JS atual cuidar via querystring

    fetch(`${window.API_BASE}/link_pedido/resolver?code=${encodeURIComponent(code)}`)
      .then(async (resp) => {
        if (!resp.ok) throw new Error(await resp.text());
        return resp.json();
      })
      .then(({ tabela_id, com_frete }) => {
        window.currentTabelaId = tabela_id;   // usado no JS principal
        window.currentComFrete = com_frete;   // usado no JS principal
        const titulo = document.getElementById("tituloValorFrete");
        if (titulo) titulo.textContent = com_frete ? "c/ Frete" : "s/ Frete";
      })
      .catch((err) => {
        document.body.innerHTML = `<h2>Link inválido ou expirado</h2><p>${String(err)}</p>`;
      });
  } catch (err) {
    document.body.innerHTML = `<h2>Erro</h2><p>${String(err)}</p>`;
  }
})();
</script>
  <script src="/static/tabela_preco/pedido_cliente.js"></script>
</body>
</html>