<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Criação de Tabela de Preço</title>

  <!-- Bootstrap igual à tela de cliente -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- CSS específico da página -->
  <link rel="stylesheet" href="criacao_tabela_preco.css">

  <!-- Navbar SEMPRE por último, para garantir o padding-top do header fixo -->
  <link rel="stylesheet" href="../navbar.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script src="../js/config.js"></script>
  <script src="../js/auth.js"></script>
  <script src="../js/sidebar_control.js"></script>
  <script src="criacao_tabela_preco.js" defer></script>
</head>


<body>
  <header>
    <div class="navbar">
      <button class="menu-btn" id="menu-button">&#9776;</button>
      <img src="../logo.png" alt="Logo" class="logo" />
    </div>
  </header>

  <nav class="sidebar" id="sidebar">
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/clientes/cliente.html">Cadastrar Cliente</a></li>
      <li><a href="/gerenciar_tabelas/gerenciar_tabelas.html">Atualizar Catálogo</a></li>
      <li><a href="/pedido/pedido.html">Consultar Pedidos</a></li>
      <li><a href="#">Exportar Relatórios</a></li>
      <li><a href="/tabela_preco/criacao_tabela_preco.html">Tabela Preço</a></li>
      <li><a href="/produto/produto.html">Produtos</a></li>
      <li><a href="/usuarios.html">Usuários</a></li>
      <li><a href="/config_email/config_email.html">Configuração E-mail</a></li>
      <li><a href="#" onclick="window.Auth.openChangePasswordModal()">Trocar Senha</a></li>
      <li><a href="#" onclick="window.Auth.logout()">Sair</a></li>
    </ul>
  </nav>
  <div id="overlay"></div>

  <div class="page-container">

    <!-- <h1>Criação de Tabela de Preço <span class="subtle">(etapa de conferência)</span></h1> -->
    <!-- TOPO: Cabeçalho e parâmetros globais -->
    <h1> Criação de Tabela de Preço </h1>

    <section class="card pad" aria-labelledby="sec-topo">
      <div class="section-header-flex">
        <h2 id="sec-topo" class="section-title" style="margin: 0;">Dados principais</h2>
        <div class="header-info-group">
          <div class="info-item">
            <span class="info-label">Validade:</span>
            <input id="validade_tabela" class="transparent-input" type="text" readonly tabindex="-1" />
          </div>
          <div class="info-item">
            <span class="info-label">Tempo:</span>
            <input id="dias_restantes" class="transparent-input" type="text" readonly tabindex="-1" />
          </div>
        </div>
      </div>

      <div class="custom-grid" style="margin-top: 16px;">

        <!-- Row 1 Items -->
        <div class="grid-item area-nome">
          <label for="nome_tabela">Nome da Tabela</label>
          <input id="nome_tabela" type="text" placeholder="Ex.: Tabela Promocional Set/25" />
        </div>

        <div class="grid-item area-markup">
          <div class="field">
            <label for="markup_global">Markup Global %</label>
            <div class="inline">
              <input id="markup_global" class="input-mini" type="number" step="0.01" min="0" placeholder="0.00" />
              <button class="btn btn-sm d-none" id="btn-aplicar-markup-todos">Aplicar a todos</button>
            </div>
          </div>
        </div>

        <div class="grid-item area-cliente">
          <label for="cliente_nome">Cliente</label>
          <input id="cliente_nome" type="text" autocomplete="off" placeholder="Digite o nome ou CNPJ..." />
          <input id="codigo_cliente" type="hidden" />
          <input id="ramo_juridico" type="hidden" />
          <div id="cliente_suggestions" class="suggestions"></div>

          <div class="field mt-2">
            <div class="inline">
              <input id="iva_st_toggle" type="checkbox" disabled />
              <span class="hint" style="font-size: 0.85rem; color: var(--text);">Aplicar IVA_ST</span>
            </div>
          </div>
        </div>

        <!-- Row 2 Items -->
        <!-- IVA starts aligned with Cliente -->




      </div>


      <!-- Bottom (Condition / Discount) -->
      <div class="grid-condition-discount">

        <!-- Condição -->
        <!-- Condição -->
        <div class="grid-item">
          <div class="field">
            <label for="plano_pagamento">Condição de Pagamento</label>
            <div class="d-flex gap-2 align-items-center">
              <select id="plano_pagamento" class="form-select flex-grow-1"></select>
              <span class="pill ms-2" style="white-space: nowrap;">Taxa: <strong id="pill-taxa">—</strong></span>
              <button class="btn btn-sm d-none" id="btn-aplicar-condicao-todos" style="white-space: nowrap;">Aplicar a
                todos</button>
            </div>
            <div class="hint" id="hint-condicao">Carregando...</div>
          </div>
        </div>

        <!-- Desconto: Reordered -->
        <div class="grid-item area-desconto">
          <div class="field">
            <label for="desconto_global">Desconto / Fator %</label>
            <div class="d-flex gap-2 align-items-center">
              <select id="desconto_global" class="grow form-select flex-grow-1"></select>
              <span class="pill ms-2" style="white-space: nowrap;">Fator: <strong
                  id="pill-fator">—</strong><span>%</span></span>
              <button class="btn btn-sm d-none" id="btn-aplicar-todos" style="white-space: nowrap;">Aplicar a
                todos</button>
            </div>
          </div>
        </div>

        <!-- Frete: Moved Here -->
        <div class="grid-item field-frete">
          <div class="field">
            <label for="frete_kg">Frete/KG</label>
            <input id="frete_kg" class="input-mini" type="number" step="0" min="0" value="0" />
          </div>
        </div>

      </div>
    </section>

    <div class="divider"></div>

    <!-- BASE: Tabela de itens selecionados -->
    <section class="card pad" aria-labelledby="sec-itens">
      <h2 id="sec-itens" class="section-title">Produtos selecionados</h2>

      <div class="toolbar" id="toolbar-acoes">
        <button id="btn-listar" class="btn">Listar Tabelas</button>
        <button id="btn-buscar" class="btn btn-primary">Buscar Produtos</button>
        <button id="btn-editar" class="btn hidden">Editar</button>
        <button id="btn-duplicar" class="btn hidden">Duplicar</button>
        <button id="btn-remover-selecionados" class="btn btn-danger">Remover selecionados</button>
        <button id="btn-salvar" class="btn btn-green">Salvar Tabela</button>
        <button id="btn-cancelar" class="btn hidden">Cancelar</button>
      </div>

      <div class="table-wrap">
        <table id="tabela-itens">
          <thead>
            <tr>
              <th><input id="chk-all" type="checkbox" /></th>
              <th>Código</th>
              <!-- Toggle Produto: controla Embalagem(4), Grupo(5), Peso(6) -->
              <th class="th-toggle-prod">
                <label class="st-toggle-in-th" title="Mostrar/ocultar detalhes do produto">
                  <input id="prod-toggle" type="checkbox" />
                  <span class="st-title">Descrição</span>
                  <span class="chevron">▶</span>
                </label>
              </th>
              <th>Embalagem</th>
              <th>Grupo / Depto.</th>
              <th class="right">Peso Líq.</th>
              <th class="right">Valor Unitário</th>

              <!-- Toggle Desconto: controla Desc. aplicado(9) -->
              <th class="right th-toggle-desc">
                <label class="st-toggle-in-th" title="Mostrar/ocultar valor do desconto">
                  <input id="desc-toggle" type="checkbox" />
                  <span class="st-title">Fator %</span>
                  <span class="chevron">▶</span>
                </label>
              </th>
              <th class="right">Desc. aplicado (R$)</th>

              <!-- Toggle Condição: controla Cond. Pagto R$(11) -->
              <th class="th-toggle-cond">
                <label class="st-toggle-in-th" title="Mostrar/ocultar valor da condição">
                  <input id="cond-toggle" type="checkbox" />
                  <span class="st-title">Cond. Pagto</span>
                  <span class="chevron">▶</span>
                </label>
              </th>
              <th class="right">Cond. Pagto (R$)</th>
              <th class="right">Frete (R$)</th>
              <th class="right">IPI (R$)</th> <!-- foi IPI (%) -->
              <th class="th-st">
                <label class="st-toggle-in-th" title="Mostrar/ocultar detalhes de ST">
                  <input id="st-toggle" type="checkbox" />
                  <span class="st-title">Base ST (R$)</span>
                  <span class="chevron">▶</span>
                </label>
              </th> <!-- novo, no lugar do IVA_ST (%) -->
              <th class="right">ICMS próprio (R$)</th> <!-- novo -->
              <th class="right">ICMS ST cheio (R$)</th><!-- novo -->
              <th class="right">ICMS ST a reter (R$)</th><!-- novo -->
              <th class="right">Valor Final (R$)</th>
              <th class="right">Valor s/ Frete (R$)</th>
              <th class="right th-markup">
                <label class="st-toggle-in-th" title="Mostrar/ocultar colunas de Markup">
                  <input id="markup-cols-toggle" type="checkbox" />
                  <span class="st-title">Markup %</span>
                  <span class="chevron">▶</span>
                </label>
              </th>
              <th class="right col-mk-derived">Valor Final (Mk)</th>
              <th class="right col-mk-derived">Valor s/ Frete (Mk)</th>
            </tr>
          </thead>
          <tbody id="tbody-itens"></tbody>
        </table>
      </div>
    </section>
  </div>
  <!-- Lógica totalmente externa -->
  <script type="module">
    import { showGerarLinkModal } from "../js/gerar_link_pedido.js";
    window.__showGerarLinkModal = showGerarLinkModal;
  </script>

  <script>
    const menuButton = document.getElementById("menu-button");
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");

    menuButton.addEventListener("click", () => {
      sidebar.classList.toggle("active");
      overlay.style.display = sidebar.classList.contains("active") ? "block" : "none";
    });

    overlay.addEventListener("click", () => {
      sidebar.classList.remove("active");
      overlay.style.display = "none";
    });
  </script>


</body>

</html>