<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Usuários</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="../navbar.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .page-container {
            padding: 20px;
            margin-left: 250px;
            /* Sidebar width */
            max-width: 1200px;
            /* Prevent infinite stretch */
            /* margin-right: auto; -> Not needed with margin-left 250px usually, but let's see */
        }

        /* Responsive tweak: on very large screens, maybe center content area? 
           But sidebar is fixed left. Standard admin dashboard behavior is fluid. 
           Let's just keep padding. */


        /* Sidebar space */
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1f2937;
        }

        .btn-primary {
            background-color: #2563eb;
            border: none;
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
        }

        .table-responsive {
            margin-top: 1rem;
        }

        /* Modal Styles matching others */
        .custom-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .custom-modal.flex {
            display: flex;
        }

        .custom-modal-dialog {
            background: white;
            padding: 24px;
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
        }

        .custom-modal-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .custom-modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
        }
    </style>
</head>
<script src="js/config.js"></script>
<script src="js/auth.js"></script>
<script>
    if (window.Auth) {
        window.Auth.checkAuth();
    }
</script>

<body>
    <header>
        <div class="navbar">
            <button class="menu-btn" id="menu-button">&#9776;</button>
            <img src="logo.png" alt="Logo" class="logo" />
        </div>
    </header>

    <nav class="sidebar" id="sidebar">
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/clientes/cliente.html">Cadastrar Cliente</a></li>
            <li><a href="/pedido/pedido.html">Consultar Pedidos</a></li>
            <li><a href="/tabela_preco/criacao_tabela_preco.html">Tabela Preço</a></li>
            <li><a href="/produto/produto.html">Produtos</a></li>
            <li><a href="/usuarios.html" class="active">Usuários</a></li>
            <li><a href="#" onclick="window.Auth.logout()">Sair</a></li>
        </ul>
    </nav>
    <div id="overlay"></div>

    <div class="page-container">
        <div class="card">
            <div class="header">
                <div class="title">Gerenciar Usuários</div>
                <button class="btn btn-primary" onclick="window.abrirModalNovoUsuario()">+ Novo Usuário</button>
            </div>

            <div id="loading" class="text-center my-3">Carregando...</div>
            <div id="error-msg" class="alert alert-danger" style="display:none"></div>

            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nome</th>
                            <th>Email</th>
                            <th>Função</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-usuarios">
                        <!-- JS injections -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal Novo Usuário -->
    <div id="modal-novo" class="custom-modal">
        <div class="custom-modal-dialog">
            <div class="custom-modal-header">
                <div class="custom-modal-title">Novo Usuário</div>
                <button class="close-btn"
                    onclick="document.getElementById('modal-novo').style.display='none'">&times;</button>
            </div>
            <div class="custom-modal-body">
                <form id="form-novo-usuario">
                    <input type="hidden" name="user_id" id="user-id">
                    <div class="mb-3">
                        <label class="form-label">Nome</label>
                        <input type="text" class="form-control" name="nome" id="input-nome" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" name="email" id="input-email" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Senha Inicial <small class="text-muted">(Apenas na
                                criação)</small></label>
                        <input type="text" class="form-control" name="senha" id="input-senha" value="123">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Função</label>
                        <select class="form-select" name="funcao" id="input-funcao">
                            <option value="vendedor">Vendedor</option>
                            <option value="gerente">Gerente</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Criar Usuário</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Reset Senha -->
    <div id="modal-reset" class="custom-modal">
        <div class="custom-modal-dialog">
            <div class="custom-modal-header">
                <div class="custom-modal-title">Resetar Senha</div>
                <button class="close-btn"
                    onclick="document.getElementById('modal-reset').style.display='none'">&times;</button>
            </div>
            <div class="custom-modal-body">
                <p>Defina a nova senha para o usuário <strong id="reset-user-email"></strong>:</p>
                <form id="form-reset-senha">
                    <input type="hidden" id="reset-user-id">
                    <div class="mb-3">
                        <label class="form-label">Nova Senha</label>
                        <input type="text" class="form-control" id="reset-nova-senha" required>
                    </div>
                    <button type="submit" class="btn btn-danger w-100">Confirmar Reset</button>
                </form>
            </div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/sidebar_control.js"></script>
    <script src="js/usuarios.js"></script>
    <script>
        // Sidebar logic common to all pages
        const menuButton = document.getElementById("menu-button");
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("overlay");
        if (menuButton) {
            menuButton.addEventListener("click", () => {
                sidebar.classList.toggle("active");
                overlay.style.display = sidebar.classList.contains("active") ? "block" : "none";
            });
            overlay.addEventListener("click", () => {
                sidebar.classList.remove("active");
                overlay.style.display = "none";
            });
        }
    </script>
</body>

</html>